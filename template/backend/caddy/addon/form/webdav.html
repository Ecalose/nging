<div class="form-group">
    <label class="col-sm-2 control-label">{{"网址路径"|T}}</label>
    <div class="col-sm-10">
       <input type="text" class="form-control" name="webdav_url" value="{{Val "webdav_url" "/"}}">
    </div>
  </div>
  <div class="form-group">
    <label class="col-sm-2 control-label">{{"根目录"|T}}</label>
    <div class="col-sm-10">
       <input type="text" class="form-control" value="{{Form "webdav_root"}}" name="webdav_root" required="required">
    </div>
  </div>
<div class="form-group">
    <label class="col-sm-2 control-label">{{"修改文件"|T}}</label>
    <div class="col-sm-10">{{$v := Form "webdav_modify"}}
        <div class="radio radio-primary radio-inline"> 
          <input type="radio" value="1" id="webdav-modify-1" name="webdav_modify"{{if eq $v "1"}} checked{{end}}><label for="webdav-modify-1">{{"允许"|T}}</label> 
        </div>
        <div class="radio radio-danger radio-inline"> 
          <input type="radio" value="0" id="webdav-modify-0" name="webdav_modify"{{if or (eq $v "0") (eq $v "")}} checked{{end}}><label for="webdav-modify-0">{{"不允许"|T}}</label> 
        </div>
    </div>
  </div>
  <div class="form-group">
    <label class="col-sm-2 control-label">{{"全局权限"|T}}</label>
    <div class="col-sm-10">
        <table>
								        <thead>
								        	<tr>
								        		<th>{{"权限"|T}}</th>
								        		<th>{{"资源路径 (相对于“根目录”)"|T}}</th>
								        		<th width="70">{{"删除"|T}}</th>
								        	</tr>
								        </thead>
								        <tbody>
                                {{$perms := FormValues "webdav_perms[global]"}}
                                {{$plen := len $perms}}
                                {{range $k,$v:=FormValues "webdav_resources[global]"}}
                                {{if lt $k $plen}}
<tr>
	<td><select class="form-control" name="webdav_perms[global]">
        {{$perm := index $perms $k}}
        <option value="1"{{if eq $perm "1"}} selected{{end}}>{{`允许`|T}}</option>
        <option value="0"{{if eq $perm "0"}} selected{{end}}>{{`禁止`|T}}</option>
    </select></td>
	<td>
        <input type="text" class="form-control" name="webdav_resources[global]" value="{{$v}}">
    </td>
	<td class="text-center">
    <button type="button" class="btn btn-danger" onclick="$(this).parent().parent().remove()">
      <i class="fa fa-times"></i>
    </button>
  </td>
</tr>
                                {{end}}
                                {{end}}
								        	<tr>
								        		<td colspan="3" class="text-center primary-emphasis" style="cursor:pointer" onclick="$(this).parent().before($('#webdavTmplAddVariableRowG').html());"><i class="fa fa-plus"></i></td>
								        	</tr>
								        </tbody>
							      </table>
        </div>
    </div>

  <div class="form-group">
    <label class="col-sm-2 control-label">{{"用户权限"|T}}</label>
    <div class="col-sm-10">
        {{$users := FormValues "webdav_user"}}
        {{$ulen := len $users}}
        {{range $uk,$uv:=FormValues "webdav_pass"}}
        {{if lt $uk $ulen}}
        <div class="webdav-user-perm margin-bottom-10" id="webdav-user-perm-{{$uk}}">
        <span class="input-group">
            <span class="input-group-addon">{{`用户名`|T}}</span>
            <input type="hidden" name="webdav_user_index" value="{{$uk}}">
            <input type="text" class="form-control" name="webdav_user" value="{{index $users $uk}}">
            <span class="input-group-addon">{{`密码`|T}}</span>
            <input type="text" class="form-control" name="webdav_pass" value="{{$uv}}">
            <span class="input-group-btn"><a class="btn btn-danger" onclick="$('#webdav-user-perm-{{$uk}}').remove();" title="{{`删除此用户规则`|T}}"><i class="fa fa-times"></i></a></span>
        </span>
        <table>
								        <thead>
								        	<tr>
								        		<th>{{"权限"|T}}</th>
								        		<th>{{"资源路径 (相对于“根目录”)"|T}}</th>
								        		<th width="70">{{"删除"|T}}</th>
								        	</tr>
								        </thead>
								        <tbody>
                                {{$perms := FormValues (printf "webdav_perms[user][%v]" $uk)}}
                                {{$plen := len $perms}}
                                {{range $k,$v:=FormValues (printf "webdav_resources[user][%v]" $uk)}}
                                {{if lt $k $plen}}
<tr>
	<td><select class="form-control" name="webdav_perms[user][{{$uk}}]">
        {{$perm := index $perms $k}}
        <option value="1"{{if eq $perm "1"}} selected{{end}}>{{`允许`|T}}</option>
        <option value="0"{{if eq $perm "0"}} selected{{end}}>{{`禁止`|T}}</option>
    </select></td>
	<td>
        <input type="text" class="form-control" name="webdav_resources[user][{{$uk}}]" value="{{$v}}">
    </td>
	<td class="text-center">
    <button type="button" class="btn btn-danger" onclick="$(this).parent().parent().remove()">
      <i class="fa fa-times"></i>
    </button>
  </td>
</tr>
                                {{end}}
                                {{end}}
								        	<tr>
								        		<td colspan="3" class="text-center primary-emphasis" style="cursor:pointer" onclick="addWebdavUserRes(this,'{{$uk}}');"><i class="fa fa-plus"></i></td>
								        	</tr>
								        </tbody>
							      </table>
                </div><!-- /.webdav-user-perm -->
        {{end}}
        {{end}}
        <a class="btn btn-success no-margin-left" href="javascript:;" onclick="addWebdavUser(this);">{{`添加用户`|T}}</a>
        </div>
    </div>
<script type="text/template" id="webdavTmplAddVariableRowG">
<tr>
	<td><select class="form-control" name="webdav_perms[global]">
        <option value="1">{{`允许`|T}}</option>
        <option value="0">{{`禁止`|T}}</option>
    </select></td>
	<td><input type="text" class="form-control" name="webdav_resources[global]" value="" required="required"></td>
	<td class="text-center">
    <button type="button" class="btn btn-danger" onclick="$(this).parent().parent().remove()">
      <i class="fa fa-times"></i>
    </button>
  </td>
</tr>
</script>
<script type="text/template" id="webdavTmplAddUserPerm">
<div class="webdav-user-perm margin-bottom-10" id="webdav-user-perm-{=userIndex=}">
    <span class="input-group">
        <span class="input-group-addon">{{`用户名`|T}}</span>
        <input type="hidden" name="webdav_user_index" value="{=userIndex=}">
        <input type="text" class="form-control" name="webdav_user" value="">
        <span class="input-group-addon">{{`密码`|T}}</span>
        <input type="text" class="form-control" name="webdav_pass" value="">
        <span class="input-group-btn"><a class="btn btn-danger" onclick="$('#webdav-user-perm-{=userIndex=}').remove();" title="{{`删除此用户规则`|T}}"><i class="fa fa-times"></i></a></span>
    </span>
    <table>
		<thead>
			<tr>
				<th>{{"权限"|T}}</th>
				<th>{{"资源路径 (相对于“根目录”)"|T}}</th>
				<th width="70">{{"删除"|T}}</th>
			</tr>
		</thead>
		<tbody>
			<tr>
				<td colspan="3" class="text-center primary-emphasis" style="cursor:pointer" onclick="addWebdavUserRes(this,'{=userIndex=}');"><i class="fa fa-plus"></i></td>
			</tr>
		</tbody>
	</table>
</div><!-- /.webdav-user-perm -->
</script>
<script type="text/javascript">
function addWebdavUserRes(a,userIndex){
    var tmpl=$('#webdavTmplAddVariableRowG').html();
    tmpl=tmpl.replace(/\[global\]/g,'[user]['+userIndex+']');
    $(a).parent().before(tmpl);
}
function addWebdavUser(a){
    var tmpl=$('#webdavTmplAddUserPerm').html();
    var nextIdx=parseInt($('input[name="webdav_user_index"]:last').val()||0)+1;
    tmpl=tmpl.replace(/\{=userIndex=\}/g,nextIdx);
    $(a).before(tmpl);
}
</script>