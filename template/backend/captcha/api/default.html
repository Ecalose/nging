{{if $.Data.jsURL}}<script src="{{$.Data.jsURL}}" async defer></script>{{end}}
{{- $themeColor := $.ThemeColor -}}
{{if eq $.Data.provider `turnstile`}}
<div class="form-control-plaintext xs-padding-top bg-fc">
<input type="hidden" name="captchaEnabled" value="1" />
<div class="cf-turnstile text-center" id="turnstile-{{$.Data.uniqid}}" data-sitekey="{{$.Data.siteKey}}" data-theme="{{if eq $themeColor `dark`}}dark{{else}}light{{end}}"></div>
</div>
<input type="hidden" id="turnstile-{{$.Data.uniqid}}-extend" disabled />
<script>
window["windowOriginalOnload{{$.Data.uniqid}}"]=window.onload;
window.onload=function(){
    turnstile.ready(function(){
        $('#turnstile-{{$.Data.uniqid}}').data('lastGeneratedAt',(new Date()).getTime());
    });
    var $form=$('#turnstile-{{$.Data.uniqid}}').closest('form');
    $form.on('submit',function(e){
        if($('#turnstile-{{$.Data.uniqid}}').data('lastGeneratedAt')>(new Date()).getTime()-290) {
            $('#turnstile-{{$.Data.uniqid}}').data('lastGeneratedAt',0);
            return true;
        }
        window.setTimeout(function(){
            turnstile.reset('#turnstile-{{$.Data.uniqid}}');
        },1000);
        $('#turnstile-{{$.Data.uniqid}}').data('lastGeneratedAt',(new Date()).getTime());
    });
    window["windowOriginalOnload{{$.Data.uniqid}}"] && window["windowOriginalOnload{{$.Data.uniqid}}"].apply(this,arguments);
}
</script>
{{else}}
<input type="hidden" name="captchaEnabled" value="1" />
<input type="hidden" id="recaptcha-{{$.Data.uniqid}}" name="g-recaptcha-response" value="" />
<input type="hidden" id="recaptcha-{{$.Data.uniqid}}-extend" disabled />
<script>
window["windowOriginalOnload{{$.Data.uniqid}}"]=window.onload;
window.onload=function(){
    grecaptcha.ready(function() {
      grecaptcha.execute('{{$.Data.siteKey}}', {action: 'submit'}).then(function(token) {
        $('#recaptcha-{{$.Data.uniqid}}').val(token);
        $('#recaptcha-{{$.Data.uniqid}}').data('lastGeneratedAt',(new Date()).getTime());
      });
    });
    var $submit=$('#recaptcha-{{$.Data.uniqid}}').closest('form').find(':submit');
    $submit.on('click',function(e){
        if($('#recaptcha-{{$.Data.uniqid}}').val() && $('#recaptcha-{{$.Data.uniqid}}').data('lastGeneratedAt')>(new Date()).getTime()-110) {
            $('#recaptcha-{{$.Data.uniqid}}').data('lastGeneratedAt',0);
            return true;
        }
        var $this=$(this);
        e.preventDefault();
        grecaptcha.execute('{{$.Data.siteKey}}', {action: 'submit'}).then(function(token) {
          $('#recaptcha-{{$.Data.uniqid}}').val(token);
          $('#recaptcha-{{$.Data.uniqid}}').data('lastGeneratedAt',(new Date()).getTime());
          $this.trigger('click');
        });
    });
    window["windowOriginalOnload{{$.Data.uniqid}}"] && window["windowOriginalOnload{{$.Data.uniqid}}"].apply(this,arguments);
}
</script>
{{end}}