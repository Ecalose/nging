(function(){var i,n="#CPU-Usage",t="#Net-Usage",r="#NetPacket-Usage",o="#Temp-Stat";function e(e,t,i){return i.series.label+": "+i.datapoint[1].toFixed(2)}function a(e,t,i){return i.series.label+": "+c(i.datapoint[1].toFixed(2),true)}function l(e,t,i){return i.series.label+": "+App.formatBytes(i.datapoint[1])}function s(e,t,i){return i.series.label+": "+i.datapoint[1]+"℃"}function d(e,t){var i=new Date(e);if(t||i.getSeconds()%10==0){var n=i.getHours()<10?"0"+i.getHours():i.getHours();var r=i.getMinutes()<10?"0"+i.getMinutes():i.getMinutes();var o=i.getSeconds()<10?"0"+i.getSeconds():i.getSeconds();return n+":"+r+":"+o}return""}function c(e,t){if(t||e%10==0)return e+"%";return""}App.plotHover(n,a);App.plotHover(t,l);App.plotHover(r,e);App.plotHover(o,s);var u,f,p,h,w={series:{lines:{show:true,lineWidth:2,fill:true,fillColor:{colors:[{opacity:.25},{opacity:.25}]}},points:{show:false},shadowSize:2},legend:{show:true},grid:{labelMargin:10,axisMargin:500,hoverable:true,clickable:true,tickColor:"rgba(0,0,0,0.15)",borderWidth:0},colors:["#B450B2","#4A8CF7","#52e136"],xaxis:{mode:"time",tickSize:[2,"second"],tickFormatter:function(e,t){return d(e)}},yaxis:{min:0,max:100,tickSize:10,tickFormatter:function(e,t){return c(e)}}},g={series:{lines:{show:true,lineWidth:2,fill:true,fillColor:{colors:[{opacity:.25},{opacity:.25}]}},points:{show:false},shadowSize:2},legend:{show:true},grid:{labelMargin:10,axisMargin:500,hoverable:true,clickable:true,tickColor:"rgba(0,0,0,0.15)",borderWidth:0},colors:["#B450B2","#4A8CF7","#52e136"],xaxis:{mode:"time",tickSize:[2,"second"],tickFormatter:function(e,t){return d(e)}},yaxis:{tickFormatter:function(e,t){return App.formatBytes(e)}}},v={series:{lines:{show:true,lineWidth:2,fill:true,fillColor:{colors:[{opacity:.25},{opacity:.25}]}},points:{show:false},shadowSize:2},legend:{show:true},grid:{labelMargin:10,axisMargin:500,hoverable:true,clickable:true,tickColor:"rgba(0,0,0,0.15)",borderWidth:0},colors:["#B450B2","#4A8CF7","#52e136"],xaxis:{mode:"time",tickSize:[2,"second"],tickFormatter:function(e,t){return d(e)}}},m={series:{lines:{show:true,lineWidth:2,fill:true,fillColor:{colors:[{opacity:.25},{opacity:.25}]}},points:{show:false},shadowSize:2},legend:{show:true,noColumns:8,container:$("#Temp-Legend")[0]},grid:{labelMargin:10,axisMargin:500,hoverable:true,clickable:true,tickColor:"rgba(0,0,0,0.15)",borderWidth:0},colors:["#B450B2","#4A8CF7","#52e136"],xaxis:{mode:"time",tickSize:[2,"second"],tickFormatter:function(e,t){return d(e)}},yaxis:{min:0,max:100,tickSize:10,tickFormatter:function(e,t){return e+"℃"}}};function b(e){return[{data:e.Net.BytesRecv,label:App.i18n.chart.DOWNLOAD_SPEED},{data:e.Net.BytesSent,label:App.i18n.chart.UPLOAD_SPEED}]}function C(e){f.setData(e);f.setupGrid();f.draw()}function x(e){data=b(e);f=$(t).data("plot");if(!f)return S(data);C(data)}function S(e){$(t+"-Box").removeClass("hidden");f=$.plot($(t),e,g);$(t).data("plot",f)}function k(e){return[{data:e.Net.PacketsRecv,label:App.i18n.chart.RECV_PACKETS},{data:e.Net.PacketsSent,label:App.i18n.chart.SENT_PACKETS}]}function A(e){p.setData(e);p.setupGrid();p.draw()}function B(e){var t=k(e);p=$(r).data("plot");if(!p)return y(t);A(t)}function y(e){$(r+"-Box").removeClass("hidden");p=$.plot($(r),e,v);$(r).data("plot",p)}function z(e){var t=[];for(var i in e.Temp){t.push({data:e.Temp[i],label:i})}return t}function M(e){h.setData(e);h.setupGrid();h.draw()}function F(e){var t=z(e);if(t.length>0){h=$(o).data("plot");if(!h)return E(t);M(t)}}function E(e){m.legend.noColumns=e.length;m.series.lines.fill=m.legend.noColumns<=3;$(o+"-Box").removeClass("hidden");h=$.plot($(o),e,m);$(o).data("plot",h)}function _(e){return[{data:e.CPU,label:App.i18n.chart.CPU_USAGE},{data:e.Mem,label:App.i18n.chart.MEMORY_USAGE}]}function D(e){u.setData(e);u.setupGrid();u.draw()}function P(e){var t=_(e);u=$(n).data("plot");if(!u)return U(t);D(t)}function U(e){$(n+"-Box").removeClass("hidden");u=$.plot($(n),e,w);$(n).data("plot",u)}function G(){if(u){u.resize();u.setupGrid();u.draw()}if(h){h.resize();h.setupGrid();h.draw()}if(p){p.resize();p.setupGrid();p.draw()}if(f){f.resize();f.setupGrid();f.draw()}}function N(t){if(i){if(t!=null)t();return false}var e=App.wsURL(BACKEND_URL);i=new WebSocket(e+"/server/dynamic");i.onopen=function(e){if(t!=null)t();$(n+"-Box").removeClass("hidden")};i.onclose=function(e){i=null};i.onmessage=function(e){if($(n).length<1){i.close();T();return}var t=JSON.parse(e.data);P(t);x(t);B(t);F(t)};i.onerror=function(e){if(!$(n+"-Box").hasClass("hidden"))$(n+"-Box").addClass("hidden");if("data"in e)console.log(e.data);T()}}function W(){var t=$(n).width();N(function(){var e="ping";if(t<=260){e+=":10"}else if(t<=360){e+=":20"}else if(t<=500){e+=":30"}else if(t<=845){e+=":40"}try{i.send(e)}catch(e){T();console.error(e.message)}});if($(n).length<1)T()}function T(){if(typeof window._interval!="undefined"&&window._interval){clearInterval(window._interval);window._interval=null}}var H=null;function L(){if($("#Temp-Legend").length>0){var e=$(window).width(),t=$(".cl-sidebar").width(),i=Math.abs(e-t)>=10;var n=e-(i?t:0)-85;if(n<200){n=200}if(H==null||H!=n){H=n;$("#Temp-Legend").css("width",i?n:"100%");var r=(n!="100%"?n:e)*2;$("canvas.flot-base,canvas.flot-overlay").css("width",n).attr("width",r);G()}}}$(function(){T();W();window._interval=window.setInterval(W,2e3);L();$(window).on("resize",L)})})();